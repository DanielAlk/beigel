<% content_for :extra_js do %>
  Panel.contacts();
  $('[title]').tooltip();
<% end %>

<% if @object.present? %>
  <% @table_order_path = development_contacts_path(@object) if @object.class.name == 'Development' %>
  <% @table_order_path = property_contacts_path(@object) if @object.class.name == 'Property' %>
<% end %>

<div class="hidden">
  <%= form_for contacts_path, method: :delete, html: { id: 'destroy_all' }, data: { confirm: '¿Seguro eliminar?' } do %>
    <% if @object.present? %>
      <%= hidden_field_tag :after_destroy_path, request.path %>
    <% end %>
  <% end %>
  <%= form_tag (@table_order_path || contacts_path), method: :get, id: 'table-order' do %>
    <% if params[:filter].present? %>
      <% params[:filter].keys.each do |subject| %>
        <%= hidden_field :filter, subject %>
      <% end %>
    <% end %>
  <% end %>
  <% if @object.blank? %>
    <% Contact.subjects.keys.each do |subject| %>
      <%= form_tag contacts_path, method: :get, id: subject.to_s + '_filter' do %>
        <%= hidden_field :filter, subject %>
      <% end %>
    <% end %>
  <% end %>
</div>

<h1 style="margin-bottom:30px;">
  <i class="fa fa-exclamation-circle fa-fh" aria-hidden="true"></i> Notificaciones
  <% if @object.present? %>
    <small>Para: <%= link_to @object.title, @object %></small>
  <% end %>
</h1>

<% if @object.blank? %>
  <div class="admin-options btn-group btn-group-justified">
    <%= link_to 'Todos', contacts_path, class: 'btn btn-sm btn-default ' + (params[:filter].blank? ? 'active' : '') %>
    <% Contact.subjects.keys.each do |subject| %>
      <% class_append = params[:filter].present? && params[:filter].keys.include?(subject) ? 'active' : '' %>
      <%= link_to contact_subject_translate(subject), '#', class: 'btn btn-sm btn-default ' + class_append, data: { submit: '#' + subject + '_filter' } %>
    <% end %>
  </div>
<% end %>
<div class="admin-options btn-group pull-right">
  <%= link_to contacts_path, title: 'Marcar seleccionados como no leídos', class: 'btn btn-sm btn-warning disabled', data: { collect_ids: 'contact[ids][]', read: 0 } do %>
    <i class="fa fa-exclamation fa-fw" aria-hidden="true"></i>
  <% end %>
  <%= link_to contacts_path, title: 'Marcar seleccionados como leídos', class: 'btn btn-sm btn-primary disabled', data: { collect_ids: 'contact[ids][]', read: 1 } do %>
    <i class="fa fa-check fa-fw" aria-hidden="true"></i>
  <% end %>
  <%= link_to '#destroy_all', title: 'Eliminar seleccionados', class: 'btn btn-sm btn-danger disabled', data: { collect_ids: 'contact[ids][]' } do %>
    <i class="fa fa-trash-o fa-fw" aria-hidden="true"></i>
  <% end %>
</div>

<p><%= page_entries_info @contacts %></p>

<% if @contacts.present? %>
  <table class="table table-hover table-condensed">
    <thead>
      <tr>
        <th>
          <label class="checkbox-inline" style="height:auto;line-height:inherit;">
            <input type="checkbox" name="select_all" data-target=".checkbox-target">
          </label>
        </th>
        <% if (params[:filter].keys.include? 'development' rescue false) || (params[:filter].keys.include? 'property' rescue false) || params[:filter].blank? %>
          <%= table_order 'Inmueble/Emprendimiento', :contactable %>
        <% end %>
        <%= table_order 'Name', :name %>
        <%= table_order 'Email', :email %>
        <%= table_order 'Tel', :tel %>
        <%= table_order 'Subject', :subject %>
        <%= table_order 'Fecha', :created_at, :desc %>
        <%= table_order '<i class="fa fa-exclamation fa-fw inactive" aria-hidden="true"></i>'.html_safe, :read %>
        <th colspan="2"></th>
      </tr>
    </thead>

    <tbody>
      <% @contacts.each do |contact| %>
        <% if @object.present? %>
          <% @contact_show_path = development_contact_path(@object, contact, back: request.url) if @object.class.name == 'Development' %>
          <% @contact_show_path = property_contact_path(@object, contact, back: request.url) if @object.class.name == 'Property' %>
        <% else %>
          <% @contact_show_path = contact_path(contact, back: request.url) %>
        <% end %>
        <tr class="<%= 'bold' unless contact.read %>" id="contact_<%= contact.id %>" data-id="<%= contact.id %>">
          <td>
            <label class="checkbox-inline" style="height:auto;line-height:inherit;">
              <input class="checkbox-target" type="checkbox" name="contact[ids][]" id="contact_id_<%= contact.id %>" value="<%= contact.id %>">
            </label>
          </td>
          <% if (params[:filter].keys.include? 'development' rescue false) || (params[:filter].keys.include? 'property' rescue false) || params[:filter].blank? %>
            <td>
              <% if contact.contactable.present? %>
                <%= link_to contact.contactable, title: 'Ver ' + (contact.development? ? 'Emprendimiento' : 'Inmueble'), class: 'table-photo-link' do %>
                  <%= image_tag contact.contactable.images.first.item.url(:thumb) %>
                  <span><%= contact.contactable.title %></span>
                <% end %>
              <% else %>
                <div class="text-center"> - </div>
              <% end %>
            </td>
          <% end %>
          <td data-href="<%= @contact_show_path %>"><%= contact.name %></td>
          <td data-href="<%= @contact_show_path %>"><%= contact.email %></td>
          <td data-href="<%= @contact_show_path %>"><%= contact.tel %></td>
          <td data-href="<%= @contact_show_path %>"><%= contact.subject_es %></td>
          <td data-href="<%= @contact_show_path %>"><%= contact.created_at.strftime '%d-%m-%Y %H:%Mhs.' %></td>
          <td>
            <%= link_to contact, title: 'Marcar como leído/no leído', style: "color:#00944B;", class: 'active-toggle' + (contact.read ? ' active' : ''), data: { id: contact.id, read: contact.read } do %>
              <i class="fa fa-spinner fa-pulse fa-fw"></i>
              <i class="fa fa-exclamation fa-fw inactive" aria-hidden="true"></i>
              <i class="fa fa-check fa-fw active" aria-hidden="true"></i>
            <% end %>
          </td>
          <td>
            <%= link_to @contact_show_path, title: 'Leer', style: "color:#00944B;" do %>
              <i class="fa fa-file-text-o fa-fw" aria-hidden="true"></i>
            <% end %>
          </td>
          <td>
            <% if @object.blank? %>
              <%= link_to contact, title: 'eliminar', style: "color:#E26E6E;", method: :delete, data: { confirm: 'Are you sure?' } do %>
                <i class="fa fa-trash-o fa-fw fa-lg" aria-hidden="true"></i>
              <% end %>
            <% else %>
              <%= link_to contact, title: 'eliminar', style: "color:#E26E6E;", data: { submit: '#edit_contact_' + contact.id.to_s } do %>
                <i class="fa fa-trash-o fa-fw fa-lg" aria-hidden="true"></i>
              <% end %>
              <div class="hidden">
                <%= form_for contact, method: :delete, data: { confirm: '¿Seguro eliminar?' } do |f| %>
                  <%= hidden_field_tag :after_destroy_path, request.path %>
                <% end %>
              </div>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <br>

  <%= will_paginate @properties %>
<% end %>